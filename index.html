<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JP Word Lab</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fefefe;
      margin: 2em;
      color: #333;
    }
    h1 { color: #d72638; }
    input, button {
      padding: 0.5em;
      font-size: 1em;
      margin: 0.2em 0;
    }
    .word {
      margin-bottom: 1em;
    }
  </style>
</head>
<body>
  <h1>JP Word Lab</h1>

  <!-- üîç –ü–æ–∏—Å–∫ -->
  <input type="text" id="search-word" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –Ω–∞ JP / EN / RU" />
  <button onclick="searchWord()">üîç –ù–∞–π—Ç–∏</button>
  <div id="search-result"></div>

  <!-- üóÇÔ∏è –°–ª–æ–≤–∞—Ä—å -->
  <h2>üìî –ú–æ–π —Å–ª–æ–≤–∞—Ä—å</h2>
  <div id="word-list"></div>

  <script>
    const searchInput = document.getElementById('search-word');
    const searchResult = document.getElementById('search-result');
    const wordList = document.getElementById('word-list');
    let words = JSON.parse(localStorage.getItem('jpWords')) || [];

    function renderWords() {
      wordList.innerHTML = '';
      words.forEach((word, index) => {
        const div = document.createElement('div');
        div.className = 'word';
        div.innerHTML = `
          <strong>${word.jp}</strong> - ${word.en} - ${word.ru}
          <button onclick="deleteWord(${index})">üóëÔ∏è</button>
        `;
        wordList.appendChild(div);
      });
    }

    function deleteWord(index) {
      words.splice(index, 1);
      localStorage.setItem('jpWords', JSON.stringify(words));
      renderWords();
    }

    function searchWord() {
      const query = searchInput.value.trim();
      if (!query) return;

      searchResult.innerHTML = "‚è≥ –ü–æ–∏—Å–∫...";
      fetch(`https://cors-anywhere.herokuapp.com/https://jisho.org/api/v1/search/words?keyword=${query}`)
        .then(res => res.json())
        .then(data => {
          if (data.data.length === 0) {
            searchResult.innerHTML = "<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>";
            return;
          }
          const word = data.data[0];
          const jp = word.japanese[0].word || word.japanese[0].reading;
          const reading = word.japanese[0].reading;
          const en = word.senses[0].english_definitions.join(', ');

          searchResult.innerHTML = `
            <p><strong>${jp}</strong> [${reading}] ‚Äî ${en}</p>
            <button onclick='addToDictionary("${jp}", "${en}", " ")'>‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
          `;
        })
        .catch(err => {
          console.error(err);
          searchResult.innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞. –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–∫—Å–∏ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.</p>";
        });
    }

    function addToDictionary(jp, en, ru) {
      words.push({ jp, en, ru });
      localStorage.setItem('jpWords', JSON.stringify(words));
      renderWords();
      searchResult.innerHTML = "<p>‚úÖ –°–ª–æ–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–ª–æ–≤–∞—Ä—å!</p>";
    }

    renderWords();
  </script>
</body>
</html>
