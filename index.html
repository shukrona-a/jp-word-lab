<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JP Word Lab</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fefefe;
      margin: 2em;
      color: #333;
    }
    h1 {
      color: #d72638;
    }
    input, button {
      padding: 0.5em;
      font-size: 1em;
      margin: 0.2em 0;
    }
    .word {
      margin-bottom: 1em;
    }
    nav {
      margin-bottom: 1em;
    }
    nav button {
      margin-right: 0.5em;
    }
  </style>
</head>
<body>
  <h1>JP Word Lab</h1>

  <nav>
    <button onclick="showSection('dictionary')">üìñ –°–ª–æ–≤–∞—Ä—å</button>
    <button onclick="showSection('saved')">üíæ –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Å–ª–æ–≤–∞</button>
  </nav>

  <!-- üîç –ü–æ–∏—Å–∫ —Å–ª–æ–≤–∞ -->
  <section id="dictionary">
    <h2>üîç –ü–æ–∏—Å–∫ —Å–ª–æ–≤–∞ (–Ω–∞ –∞–Ω–≥–ª / —Ä—É—Å / —è–ø)</h2>
    <input type="text" id="search-input" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å–æ–ª–Ω—Ü–µ" />
    <button onclick="searchWord()">–ü–æ–∏—Å–∫</button>
    <div id="search-results"></div>
  </section>

  <!-- üíæ –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ -->
  <section id="saved" style="display:none;">
    <h2>üíæ –ú–æ—è —Ç–µ—Ç—Ä–∞–¥—å —Å–ª–æ–≤</h2>
    <div id="saved-words"></div>
  </section>

  <script>
    function showSection(id) {
      ['dictionary', 'saved'].forEach(section => {
        document.getElementById(section).style.display = section === id ? 'block' : 'none';
      });
    }

    let savedWords = JSON.parse(localStorage.getItem('savedWords')) || [];

    function saveWord(wordData) {
      savedWords.push(wordData);
      localStorage.setItem('savedWords', JSON.stringify(savedWords));
      renderSavedWords();
    }

    function renderSavedWords() {
      const container = document.getElementById('saved-words');
      container.innerHTML = '';
      if (savedWords.length === 0) {
        container.innerHTML = '<p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–ª–æ–≤.</p>';
        return;
      }
      savedWords.forEach((word, i) => {
        const div = document.createElement('div');
        div.className = 'word';
        div.innerHTML = `
          <strong>${word.word}</strong> (${word.reading}) ‚Äî ${word.meaning}
          <button onclick="deleteWord(${i})">–£–¥–∞–ª–∏—Ç—å</button>
        `;
        container.appendChild(div);
      });
    }

    function deleteWord(index) {
      savedWords.splice(index, 1);
      localStorage.setItem('savedWords', JSON.stringify(savedWords));
      renderSavedWords();
    }

    async function searchWord() {
      const query = document.getElementById('search-input').value.trim();
      const container = document.getElementById('search-results');
      container.innerHTML = '–ü–æ–∏—Å–∫...';

      if (!query) {
        container.innerHTML = '–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞.';
        return;
      }

      try {
        const response = await fetch(`https://cors-anywhere.herokuapp.com/https://jisho.org/api/v1/search/words?keyword=${encodeURIComponent(query)}`);
        const data = await response.json();

        if (data.data.length === 0) {
          container.innerHTML = '<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>';
          return;
        }

        const wordData = data.data[0];
        const word = wordData.japanese[0].word || wordData.japanese[0].reading;
        const reading = wordData.japanese[0].reading;
        const meaning = wordData.senses[0].english_definitions.join(', ');

        container.innerHTML = `
          <p><strong>${word}</strong> (${reading}) ‚Äî ${meaning}</p>
          <button onclick='saveWord(${JSON.stringify({word, reading, meaning})})'>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        `;
      } catch (error) {
        container.innerHTML = '<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>';
        console.error(error);
      }
    }

    // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
    renderSavedWords();
  </script>
</body>
</html>
