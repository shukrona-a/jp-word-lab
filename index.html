<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JP Word Lab</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fefefe;
      margin: 2em;
      color: #333;
    }
    h1 {
      color: #d72638;
    }
    .word {
      margin-bottom: 1em;
    }
    input, button {
      padding: 0.5em;
      font-size: 1em;
      margin: 0.2em 0;
    }
    nav {
      margin-bottom: 1em;
    }
    nav button {
      margin-right: 0.5em;
    }
    .flashcard {
      border: 1px solid #ccc;
      padding: 1em;
      margin: 0.5em 0;
      cursor: pointer;
      background: #fafafa;
    }
  </style>
</head>
<body>
  <h1>JP Word Lab</h1>
  <nav>
    <button onclick="showSection('dictionary')">üìñ –°–ª–æ–≤–∞—Ä—å</button>
    <button onclick="showSection('notebook')">üíæ –ú–æ—è —Ç–µ—Ç—Ä–∞–¥—å —Å–ª–æ–≤</button>
    <button onclick="showSection('flashcards')">üìö –ö–∞—Ä—Ç–æ—á–∫–∏</button>
    <button onclick="showSection('quiz')">üß† –ò–≥—Ä–∞</button>
    <button onclick="showSection('kanji')">Êº¢Â≠ó –ö–∞–Ω–∑–∏</button>
  </nav>

  <!-- üìñ Dictionary Search -->
  <section id="dictionary">
    <h2>üîç –ü–æ–∏—Å–∫ —Å–ª–æ–≤–∞ (–Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ)</h2>
    <input type="text" id="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ...">
    <button onclick="searchWord()">–ò—Å–∫–∞—Ç—å</button>
    <div id="search-results"></div>
  </section>

  <!-- üíæ Saved Words -->
  <section id="notebook" style="display:none;">
    <h2>üíæ –ú–æ—è —Ç–µ—Ç—Ä–∞–¥—å —Å–ª–æ–≤</h2>
    <div id="word-list"></div>
  </section>

  <!-- üìö Flashcards -->
  <section id="flashcards" style="display:none;">
    <h2>üìö –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h2>
    <div id="flashcard-container"></div>
  </section>

  <!-- üß† Quiz Game -->
  <section id="quiz" style="display:none;">
    <h2>üß† –í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥</h2>
    <div id="quiz-container">–¢—É—Ç –±—É–¥–µ—Ç –∏–≥—Ä–∞</div>
  </section>

  <!-- Êº¢Â≠ó Kanji Section -->
  <section id="kanji" style="display:none;">
    <h2>Êº¢Â≠ó –ò–∑—É—á–µ–Ω–∏–µ –∫–∞–Ω–¥–∑–∏</h2>
    <p>–ù–∞–ø–∏—à–∏—Ç–µ —Å–ª–æ–≤–æ (–Ω–∞–ø—Ä. "–æ–≥–æ–Ω—å") –∏ —É–∑–Ω–∞–π—Ç–µ –∫–∞–Ω–¥–∑–∏, —á—Ç–µ–Ω–∏–µ –∏ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏.</p>
    <input type="text" id="kanji-search" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ...">
    <button onclick="searchKanji()">–ù–∞–π—Ç–∏</button>
    <div id="kanji-results"></div>
  </section>

  <script>
    const savedWords = JSON.parse(localStorage.getItem('jpWords') || '[]');

    function showSection(id) {
      ['dictionary', 'notebook', 'flashcards', 'quiz', 'kanji'].forEach(sec => {
        document.getElementById(sec).style.display = (sec === id) ? 'block' : 'none';
      });
      if (id === 'notebook') renderSavedWords();
      if (id === 'flashcards') renderFlashcards();
      if (id === 'quiz') startQuiz();
    }

    async function searchWord() {
      const query = document.getElementById('search-input').value.trim();
      const res = await fetch(`https://corsproxy.io/?https://jisho.org/api/v1/search/words?keyword=${encodeURIComponent(query)}`);
      const data = await res.json();

      const results = document.getElementById('search-results');
      results.innerHTML = '';
      if (!data.data.length) return results.innerHTML = '<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>';

      const word = data.data[0];
      const jp = word.japanese[0].word || word.japanese[0].reading;
      const reading = word.japanese[0].reading;
      const en = word.senses[0].english_definitions.join(', ');

      results.innerHTML = `
        <p><strong>${jp}</strong> (${reading}) ‚Äî ${en}</p>
        <button onclick='saveWord("${jp}", "${reading}", "${en}")'>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      `;
    }

    function saveWord(jp, reading, en) {
      savedWords.push({ jp, reading, en });
      localStorage.setItem('jpWords', JSON.stringify(savedWords));
      alert('–°–ª–æ–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
    }

    function renderSavedWords() {
      const list = document.getElementById('word-list');
      list.innerHTML = '';
      savedWords.forEach((w, i) => {
        const div = document.createElement('div');
        div.className = 'word';
        div.innerHTML = `${w.jp} (${w.reading}) ‚Äî ${w.en} <button onclick='deleteWord(${i})'>–£–¥–∞–ª–∏—Ç—å</button>`;
        list.appendChild(div);
      });
    }

    function deleteWord(index) {
      savedWords.splice(index, 1);
      localStorage.setItem('jpWords', JSON.stringify(savedWords));
      renderSavedWords();
    }

    function renderFlashcards() {
      const container = document.getElementById('flashcard-container');
      container.innerHTML = '';
      savedWords.forEach(word => {
        const card = document.createElement('div');
        card.className = 'flashcard';
        card.textContent = word.jp;
        card.onclick = () => {
          card.textContent = `${word.jp} (${word.reading}) ‚Äî ${word.en}`;
        };
        container.appendChild(card);
      });
    }

    function startQuiz() {
      const quiz = document.getElementById('quiz-container');
      quiz.innerHTML = '';
      if (savedWords.length < 2) {
        return quiz.innerHTML = '<p>–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã 2 —Å–ª–æ–≤–∞ –¥–ª—è –∏–≥—Ä—ã.</p>';
      }
      const word = savedWords[Math.floor(Math.random() * savedWords.length)];
      const options = [...savedWords].sort(() => 0.5 - Math.random()).slice(0, 3);
      if (!options.includes(word)) options[0] = word;

      quiz.innerHTML = `<p>–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: <strong>${word.jp}</strong>?</p>`;
      options.sort(() => 0.5 - Math.random()).forEach(opt => {
        const btn = document.createElement('button');
        btn.textContent = opt.en;
        btn.onclick = () => alert(opt === word ? '–í–µ—Ä–Ω–æ!' : `–ù–µ–≤–µ—Ä–Ω–æ. –≠—Ç–æ: ${word.en}`);
        quiz.appendChild(btn);
      });
    }

    function searchKanji() {
      const input = document.getElementById("kanji-search").value.toLowerCase();
      const results = document.getElementById("kanji-results");
      results.innerHTML = "";

      const kanjiData = {
        –¥–µ—Ä–µ–≤–æ: { kanji: "Êú®", meaning: "–¥–µ—Ä–µ–≤–æ", readings: "„É¢„ÇØ (moku), „Åç (ki)", hint: "–ø–æ—Ö–æ–∂–µ –Ω–∞ –¥–µ—Ä–µ–≤–æ üå≥" },
        –ª–µ—Å: { kanji: "Ê£Æ", meaning: "–ª–µ—Å", readings: "„Ç∑„É≥ (shin), „ÇÇ„Çä (mori)", hint: "—Ç—Ä–∏ –¥–µ—Ä–µ–≤–∞ ‚Äî —ç—Ç–æ –ª–µ—Å" },
        –≤–æ–¥–∞: { kanji: "Ê∞¥", meaning: "–≤–æ–¥–∞", readings: "„Çπ„Ç§ (sui), „Åø„Åö (mizu)", hint: "–≤–æ–ª–Ω—ã –≤–æ–¥—ã" },
        –æ–≥–æ–Ω—å: { kanji: "ÁÅ´", meaning: "–æ–≥–æ–Ω—å", readings: "„Ç´ (ka), „Å≤ (hi)", hint: "–≤—Å–ø—ã—à–∫–∞ –æ–≥–Ω—è" }
      };

      if (kanjiData[input]) {
        const data = kanjiData[input];
        results.innerHTML = `
          <p><strong>${data.kanji}</strong> ‚Äî ${data.meaning}</p>
          <p><strong>–ß—Ç–µ–Ω–∏—è:</strong> ${data.readings}</p>
          <p><strong>–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:</strong> ${data.hint}</p>
        `;
      } else {
        results.innerHTML = "<p>–ö–∞–Ω–¥–∑–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ —Å–ª–æ–≤–æ.</p>";
      }
    }
  </script>
</body>
</html>
