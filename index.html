<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JP Word Lab</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fffafc;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2em;
      margin: 0;
    }
    h1, h2 {
      color: #d72638;
      text-align: center;
    }
    .container {
      max-width: 700px;
      width: 100%;
    }
    input, button {
      padding: 0.5em;
      font-size: 1em;
      margin: 0.3em 0;
      width: 100%;
      box-sizing: border-box;
    }
    nav {
      margin-bottom: 1em;
      display: flex;
      justify-content: center;
      gap: 0.5em;
      flex-wrap: wrap;
    }
    nav button {
      background: #fddde6;
      border: 1px solid #d72638;
      border-radius: 6px;
      cursor: pointer;
    }
    .word {
      background: #f9f9f9;
      padding: 0.5em;
      margin: 0.5em 0;
      border-left: 4px solid #d72638;
    }
    .flashcard, .quiz-question {
      background: #fff5f7;
      padding: 1em;
      margin-top: 1em;
      border-radius: 8px;
      text-align: center;
    }
    .flashcard button, .quiz-question button {
      margin-top: 0.5em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>JP Word Lab</h1>
    <nav>
      <button onclick="showSection('dictionary')">üìñ –°–ª–æ–≤–∞—Ä—å</button>
      <button onclick="showSection('flashcards')">üìö –ö–∞—Ä—Ç–æ—á–∫–∏</button>
      <button onclick="showSection('quiz')">üß† –ú–∏–Ω–∏-–∏–≥—Ä–∞</button>
      <button onclick="showSection('kanji')">Êº¢Â≠ó –ö–∞–Ω–¥–∑–∏</button>
    </nav>

    <!-- üìñ –°–ª–æ–≤–∞—Ä—å -->
    <section id="dictionary">
      <h2>üí¨ –ü–æ–∏—Å–∫ —Å–ª–æ–≤ —á–µ—Ä–µ–∑ Jisho (–∞–Ω–≥–ª., —Ä—É—Å., —è–ø.)</h2>
      <input type="text" id="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ...">
      <button onclick="searchWord()">–ü–æ–∏—Å–∫</button>
      <div id="search-results"></div>

      <h2>üíæ –ú–æ—è —Ç–µ—Ç—Ä–∞–¥—å —Å–ª–æ–≤</h2>
      <div id="word-list"></div>
    </section>

    <!-- üìö –ö–∞—Ä—Ç–æ—á–∫–∏ -->
    <section id="flashcards" style="display:none;">
      <h2>üìö –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</h2>
      <div id="flashcard-container"></div>
    </section>

    <!-- üß† –ú–∏–Ω–∏-–∏–≥—Ä–∞ -->
    <section id="quiz" style="display:none;">
      <h2>üß† –£–≥–∞–¥–∞–π –ø–µ—Ä–µ–≤–æ–¥</h2>
      <div id="quiz-container"></div>
    </section>

    <!-- Êº¢Â≠ó –ö–∞–Ω–¥–∑–∏ -->
    <section id="kanji" style="display:none;">
      <h2>Êº¢Â≠ó –ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏ –∏ –æ–±—É—á–µ–Ω–∏–µ</h2>
      <input type="text" id="kanji-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ...">
      <button onclick="searchKanji()">–ù–∞–π—Ç–∏</button>
      <div id="kanji-results"></div>
    </section>
  </div>

  <script>
    let words = JSON.parse(localStorage.getItem('jpWords')) || [];

    function showSection(id) {
      ['dictionary', 'flashcards', 'quiz', 'kanji'].forEach(section => {
        document.getElementById(section).style.display = (section === id) ? 'block' : 'none';
      });
    }

    function saveWords() {
      localStorage.setItem('jpWords', JSON.stringify(words));
    }

    function renderWordList() {
      const list = document.getElementById('word-list');
      list.innerHTML = '';
      words.forEach((word, i) => {
        const div = document.createElement('div');
        div.className = 'word';
        div.innerHTML = `${i + 1}. <strong>${word.jp}</strong> (${word.reading}) ‚Äî ${word.en} <button onclick="deleteWord(${i})">–£–¥–∞–ª–∏—Ç—å</button>`;
        list.appendChild(div);
      });
    }

    function deleteWord(i) {
      words.splice(i, 1);
      saveWords();
      renderWordList();
    }

    async function searchWord() {
      const query = document.getElementById('search-input').value;
      const res = await fetch(`https://cors-anywhere.herokuapp.com/https://jisho.org/api/v1/search/words?keyword=${query}`);
      const data = await res.json();
      const result = data.data[0];
      const container = document.getElementById('search-results');
      if (result) {
        const jp = result.japanese[0].word || result.japanese[0].reading;
        const reading = result.japanese[0].reading;
        const en = result.senses[0].english_definitions.join(', ');
        container.innerHTML = `<div class='word'><strong>${jp}</strong> (${reading}) ‚Äî ${en} <button onclick='addWord(` + JSON.stringify({ jp, reading, en }) + `)'>–î–æ–±–∞–≤–∏—Ç—å</button></div>`;
      } else {
        container.innerHTML = '<p>–°–ª–æ–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>';
      }
    }

    function addWord(word) {
      words.push(word);
      saveWords();
      renderWordList();
    }

    function renderFlashcards() {
      const container = document.getElementById('flashcard-container');
      container.innerHTML = '';
      let i = 0;
      if (!words.length) return container.innerHTML = '–ù–µ—Ç —Å–ª–æ–≤';

      const showCard = () => {
        const card = words[i];
        container.innerHTML = `
          <div class='flashcard'>
            <h3>${card.jp}</h3>
            <p>${card.reading}</p>
            <button onclick='document.getElementById("flashcard-container").innerHTML += "<p><strong>${card.en}</strong></p>"'>–ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥</button>
            <button onclick='i = (i + 1) % words.length; showCard()'>–°–ª–µ–¥—É—é—â–µ–µ</button>
          </div>`;
      }
      showCard();
    }

    function renderQuiz() {
      const container = document.getElementById('quiz-container');
      if (words.length < 4) return container.innerHTML = '–ù—É–∂–Ω–æ —Ö–æ—Ç—è –±—ã 4 —Å–ª–æ–≤–∞';

      const correct = words[Math.floor(Math.random() * words.length)];
      const options = [correct];
      while (options.length < 4) {
        const rand = words[Math.floor(Math.random() * words.length)];
        if (!options.includes(rand)) options.push(rand);
      }
      options.sort(() => Math.random() - 0.5);

      container.innerHTML = `
        <div class='quiz-question'>
          <h3>${correct.jp}</h3>
          ${options.map(opt => `<button onclick='alert("${opt === correct ? "–í–µ—Ä–Ω–æ!" : "–ù–µ–≤–µ—Ä–Ω–æ."}"); renderQuiz()'>${opt.en}</button>`).join('<br>')}
        </div>`;
    }

    function searchKanji() {
      const value = document.getElementById('kanji-input').value.toLowerCase();
      const results = document.getElementById('kanji-results');
      const data = {
        "–≤–æ–¥–∞": { kanji: "Ê∞¥", readings: "„Çπ„Ç§ / „Åø„Åö", hint: "–≤–æ–ª–Ω—ã –≤–æ–¥—ã üåä" },
        "–æ–≥–æ–Ω—å": { kanji: "ÁÅ´", readings: "„Ç´ / „Å≤", hint: "–≤—Å–ø—ã—à–∫–∞ –æ–≥–Ω—è üî•" },
        "–¥–µ—Ä–µ–≤–æ": { kanji: "Êú®", readings: "„É¢„ÇØ / „Åç", hint: "–ø–æ—Ö–æ–∂–µ –Ω–∞ –¥–µ—Ä–µ–≤–æ üå≥" },
        "–ª–µ—Å": { kanji: "Ê£Æ", readings: "„Ç∑„É≥ / „ÇÇ„Çä", hint: "—Ç—Ä–∏ –¥–µ—Ä–µ–≤–∞ ‚Äî —ç—Ç–æ –ª–µ—Å üå≤üå≤üå≤" }
      };
      if (data[value]) {
        const k = data[value];
        results.innerHTML = `<div class='word'><strong>${k.kanji}</strong><br>–ß—Ç–µ–Ω–∏—è: ${k.readings}<br>–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è: ${k.hint}</div>`;
      } else {
        results.innerHTML = '<p>–ö–∞–Ω–¥–∑–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω.</p>';
      }
    }

    renderWordList();
  </script>
</body>
</html>
