<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JP Word Lab</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fefefe;
      margin: 2em;
      color: #333;
    }
    h1 {
      color: #d72638;
    }
    .word {
      margin-bottom: 1em;
    }
    input, button {
      padding: 0.5em;
      font-size: 1em;
      margin: 0.2em 0;
    }
    nav {
      margin-bottom: 1em;
    }
    nav button {
      margin-right: 0.5em;
    }
    .flashcard, .quiz-option {
      border: 1px solid #ccc;
      padding: 1em;
      border-radius: 0.5em;
      margin: 0.5em 0;
    }
    .flashcard:hover, .quiz-option:hover {
      background: #f9f9f9;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>JP Word Lab</h1>

  <nav>
    <button onclick="showSection('dictionary')">üìñ –°–ª–æ–≤–∞—Ä—å</button>
    <button onclick="showSection('flashcards')">üìö –ö–∞—Ä—Ç–æ—á–∫–∏</button>
    <button onclick="showSection('tests')">üß† –¢–µ—Å—Ç</button>
    <button onclick="showSection('kanji')">Êº¢Â≠ó –ö–∞–Ω–¥–∑–∏</button>
  </nav>

  <section id="dictionary">
    <input type="text" id="search-word" placeholder="–ü–æ–∏—Å–∫ —Å–ª–æ–≤–∞ (EN, RU, JP)">
    <button onclick="searchJisho()">üîç –ù–∞–π—Ç–∏</button>
    <div id="search-result"></div>
  </section>

  <section id="flashcards" style="display:none;">
    <h2>üìö –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h2>
    <div id="flashcards-container"></div>
  </section>

  <section id="tests" style="display:none;">
    <h2>üß† –ú–∏–Ω–∏-–∏–≥—Ä–∞: –í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥</h2>
    <div id="quiz-container"></div>
  </section>

  <section id="kanji" style="display:none;">
    <h2>Êº¢Â≠ó –ö–∞–Ω–¥–∑–∏</h2>
    <input type="text" id="kanji-search" placeholder="–ù–∞–ø–∏—à–∏ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ...">
    <button onclick="searchKanji()">–ù–∞–π—Ç–∏</button>
    <div id="kanji-results"></div>
  </section>

  <h2>üíæ –ú–æ—è —Ç–µ—Ç—Ä–∞–¥—å —Å–ª–æ–≤</h2>
  <div id="word-list"></div>

  <script>
    const wordList = document.getElementById('word-list');
    const flashcardContainer = document.getElementById('flashcards-container');
    const quizContainer = document.getElementById('quiz-container');
    let words = JSON.parse(localStorage.getItem('jpWords')) || [];

    function showSection(id) {
      ['dictionary', 'flashcards', 'tests', 'kanji'].forEach(section => {
        document.getElementById(section).style.display = section === id ? 'block' : 'none';
      });
    }

    function searchJisho() {
      const query = document.getElementById("search-word").value.trim();
      if (!query) return;
      fetch(`https://cors-anywhere.herokuapp.com/https://jisho.org/api/v1/search/words?keyword=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(data => {
          const result = document.getElementById("search-result");
          result.innerHTML = "";
          if (data.data.length === 0) {
            result.innerHTML = "<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>";
            return;
          }
          const word = data.data[0];
          const jp = word.japanese[0].word || word.japanese[0].reading;
          const reading = word.japanese[0].reading;
          const en = word.senses[0].english_definitions.join(', ');
          const addBtn = `<button onclick='addWord(` + JSON.stringify(jp) + `, ` + JSON.stringify(en) + `, "")'>–î–æ–±–∞–≤–∏—Ç—å</button>`;
          result.innerHTML = `<p><strong>${jp} (${reading})</strong> ‚Äî ${en}</p>${addBtn}`;
        });
    }

    function addWord(jp, en, ru) {
      words.push({ jp, en, ru });
      localStorage.setItem('jpWords', JSON.stringify(words));
      renderWords();
    }

    function deleteWord(index) {
      words.splice(index, 1);
      localStorage.setItem('jpWords', JSON.stringify(words));
      renderWords();
    }

    function renderWords() {
      wordList.innerHTML = '';
      words.forEach((word, index) => {
        wordList.innerHTML += `<div class='word'><strong>${index + 1}. ${word.jp}</strong> ‚Äî ${word.en} ${word.ru ? '‚Äî ' + word.ru : ''} <button onclick='deleteWord(${index})'>–£–¥–∞–ª–∏—Ç—å</button></div>`;
      });
      renderFlashcards();
      renderQuiz();
    }

    function renderFlashcards() {
      flashcardContainer.innerHTML = '';
      words.forEach((word, index) => {
        flashcardContainer.innerHTML += `<div class='flashcard'><strong>${word.jp}</strong><br><em>${word.en}</em></div>`;
      });
    }

    function renderQuiz() {
      quizContainer.innerHTML = '';
      if (words.length < 2) {
        quizContainer.innerHTML = '–ù—É–∂–Ω–æ —Ö–æ—Ç—è –±—ã 2 —Å–ª–æ–≤–∞ –¥–ª—è —Ç–µ—Å—Ç–∞.';
        return;
      }
      const correctIndex = Math.floor(Math.random() * words.length);
      const correct = words[correctIndex];
      const options = [correct];
      while (options.length < 4) {
        const rand = words[Math.floor(Math.random() * words.length)];
        if (!options.includes(rand)) options.push(rand);
      }
      options.sort(() => Math.random() - 0.5);
      quizContainer.innerHTML += `<p>–ö–∞–∫–æ–π –ø–µ—Ä–µ–≤–æ–¥ —É —Å–ª–æ–≤–∞ <strong>${correct.jp}</strong>?</p>`;
      options.forEach(opt => {
        quizContainer.innerHTML += `<div class='quiz-option' onclick='alert("${opt.en === correct.en ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!' : '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ' + correct.en}")'>${opt.en}</div>`;
      });
    }

    function searchKanji() {
      const input = document.getElementById("kanji-search").value.toLowerCase();
      const results = document.getElementById("kanji-results");
      results.innerHTML = "";

      const kanjiData = {
        –¥–µ—Ä–µ–≤–æ: { kanji: "Êú®", meaning: "–¥–µ—Ä–µ–≤–æ", readings: "„É¢„ÇØ (moku), „Åç (ki)", hint: "–ø–æ—Ö–æ–∂–µ –Ω–∞ –¥–µ—Ä–µ–≤–æ üå≥" },
        –ª–µ—Å: { kanji: "Ê£Æ", meaning: "–ª–µ—Å", readings: "„Ç∑„É≥ (shin), „ÇÇ„Çä (mori)", hint: "—Ç—Ä–∏ –¥–µ—Ä–µ–≤–∞ ‚Äî —ç—Ç–æ –ª–µ—Å" },
        –≤–æ–¥–∞: { kanji: "Ê∞¥", meaning: "–≤–æ–¥–∞", readings: "„Çπ„Ç§ (sui), „Åø„Åö (mizu)", hint: "–≤–æ–ª–Ω—ã –≤–æ–¥—ã" },
        –æ–≥–æ–Ω—å: { kanji: "ÁÅ´", meaning: "–æ–≥–æ–Ω—å", readings: "„Ç´ (ka), „Å≤ (hi)", hint: "–≤—Å–ø—ã—à–∫–∞ –æ–≥–Ω—è" },
        —Å–æ–ª–Ω—Ü–µ: { kanji: "Êó•", meaning: "—Å–æ–ª–Ω—Ü–µ/–¥–µ–Ω—å", readings: "„Éã„ÉÅ (nichi), „Å≤ (hi)", hint: "–≤–æ—Å—Ö–æ–¥—è—â–µ–µ —Å–æ–ª–Ω—Ü–µ" }
      };

      if (kanjiData[input]) {
        const data = kanjiData[input];
        results.innerHTML = `<p><strong>${data.kanji}</strong> ‚Äî ${data.meaning}</p><p><strong>–ß—Ç–µ–Ω–∏—è:</strong> ${data.readings}</p><p><strong>–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è:</strong> ${data.hint}</p>`;
      } else {
        results.innerHTML = "<p>–ö–∞–Ω–¥–∑–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ —Å–ª–æ–≤–æ.</p>";
      }
    }

    renderWords();
  </script>
</body>
</html>
